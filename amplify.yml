version: 1
frontend:
  phases:
    preBuild:
      commands:
        - yarn
    build:
      commands: 
        - "[[ -d .next ]] && echo 'remove .next' && rm -rf .next"
        - "echo 'init dendron next' && npx dendron publish init"
        - "echo 'install deps...' && cd .next && yarn && cd .."
        - "echo 'build notes...' && npx dendron publish build"
        - "echo 'export...' && cd .next && yarn export"
  artifacts:
    baseDirectory: .next/out
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/node_modules/**/*
